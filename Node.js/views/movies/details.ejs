<!DOCTYPE html>

<html>

<%- include("../partials/head.ejs") %>

<body>
    <%- include("../partials/topPanel.ejs") %> 

    <div id="main">
        <div class="boxes">
            <div class="box">
                <img src="<%= movie.poster %>" alt="Plakat filmu" width="300">
            </div>
            <div class="box">
                <h1><%= movie.title %></h1>
                <h2><%= movie.director %></h2>
                <h4><%= movie.genre %></h4>
                <h4><%= movie.year %></h4>
            </div>
            <div class="box">
                <form class="rating">
                    <% if (rating) { %>
                        Twoja ocena: <%= rating.points %>
                    <% } else { %>
                    <label for="rating">Oceń film</label>
                    <input type="number" name="rating" id="rating"
                        min="1" max="10" required>
                    <button>Wyślij</button>
                    <% } %>
                </form>
            </div>
        </div>
        
        <div class="box">
            Recenzje
        </div>
    </div>

    <script>
        const form = document.querySelector("form");
        const movieId = "<%= movie.id %>";
        console.log(movieId);   

        form.addEventListener("submit", e => {
            e.preventDefault();

            const data = {
                rating: form.rating.value,
                movieId: movieId,
                userId: "<%= user.id %>"
            };

            fetch(`/movies/${movieId}/rate`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => alert(data))
            .catch(err => console.log(err));
        });
    </script>

    <%- include("../partials/footer.ejs") %> 

</body>

</html>